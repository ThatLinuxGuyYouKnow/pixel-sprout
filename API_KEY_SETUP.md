# API Key Setup Guide

## Overview

Pixel Sprout now includes a built-in settings interface to configure your Google Gemini API key. With an API key, NPCs will provide unique, contextual dialogue instead of generic hints.

## Quick Start

### 1. Get a Free Gemini API Key

1. Visit [Google AI Studio](https://aistudio.google.com) (free, no credit card required)
2. Click **"Get API Key"**
3. Create a new API key in your Google project
4. Copy the key (looks like `sk-proj-xxxxxxxxxxxxxxxxxxxxx`)

### 2. Enter Your API Key in the Game

1. **Open Settings**: Click the ‚öôÔ∏è icon in the top-right corner of the game
2. **Paste API Key**: Paste your key into the "Gemini API Key" input field
3. **Save**: Click "Save API Key"
4. **Game Reloads**: The game will automatically reload with your key active

### 3. Verify It Works

- The settings button should now show a **green dot** üü¢ indicating API is ready
- NPCs will now provide dynamic dialogue generated by Gemini 2.5 Flash
- If you see different responses each time you talk to an NPC, it's working!

## How It Works

### Storage
- Your API key is stored **locally in your browser** (localStorage)
- The key is **never sent to any server** (only directly to Google's API)
- Your key is persistent across browser sessions
- You can clear it anytime from the Settings modal

### Priority Order
The game checks for an API key in this order:

1. **localStorage** (user-provided via Settings UI) ‚Üê **Highest priority**
2. `VITE_GEMINI_API_KEY` environment variable
3. `process.env.API_KEY` environment variable
4. None (uses hardcoded hints)

### API Status Indicator

The settings button in the top-right shows your API status:

| Status | Indicator | Meaning |
|--------|-----------|---------|
| **Ready** | üü¢ Green | API key is configured and working |
| **Missing** | ‚ö™ Gray | No API key provided (using hints) |
| **Error** | üî¥ Red | API key is invalid or API call failed |

## Fallback System

If your API key is:
- **Not provided**: Game uses hardcoded, atmospheric hints
- **Invalid or expired**: Falls back to hardcoded hints automatically
- **Rate-limited**: Shows error status, but game continues with hints

### Hardcoded Hints Features
- Direction-aware (North, South, East, West, diagonals)
- Level-specific atmosphere
- Graceful degradation
- Always works, no internet required

## Managing Your Key

### View Your Saved Key
1. Open Settings
2. Check "Key: sk-proj-xxxx...xxxx" below the input field

### Update Your Key
1. Open Settings
2. Clear the input and paste a new key
3. Click "Save API Key"
4. Game reloads with the new key

### Delete Your Key
1. Open Settings
2. Click "Clear Saved Key"
3. Confirm deletion
4. Game reloads and uses hardcoded hints

## Using the API

### What Gets Sent to Google?
- **NPC Dialogue Requests**: 
  - NPC name and type
  - Player query/message
  - Relative direction to goal
  - Current level name
  - Persona (ghost, rat, etc.)

- **Dungeon Tip Requests**:
  - Current level name
  - Player health

### What's NOT Sent
- Your game save/progress
- Your inventory
- Full game state
- Any personal information
- Your location or identity

### Rate Limits
- Google's free tier: Up to 1,500 requests per minute
- Typical gameplay: ~10 requests per session
- No worries about hitting limits in normal play

## Troubleshooting

### Settings button shows red üî¥ (Error)

1. Check that your API key is valid (copy directly from Google AI Studio)
2. Verify you have internet connection
3. Try clearing and re-entering your key
4. Check Google's API status at [Google Cloud Console](https://console.cloud.google.com)

### NPC responses still seem generic

- Game uses hardcoded hints while API key is being validated
- Close and reopen the Settings modal
- If still generic after reload, API may not be initialized yet
- Try talking to another NPC or wait a moment

### Key doesn't save

1. Ensure your browser allows localStorage
2. Disable browser privacy extensions temporarily
3. Try a different browser
4. Check browser's developer console for errors

### API key got deleted

1. Don't worry! Your save game isn't affected
2. Paste a new key in Settings
3. The game will continue with dynamic dialogue again

## Security Notes

‚úÖ **Safe Practices**
- Key stored only in your browser
- Never transmitted to our servers
- You can delete it anytime
- Visit only google.com for API key generation

‚ö†Ô∏è **Be Careful**
- Don't share your API key with anyone
- Don't post it on public forums or chat
- If exposed, regenerate it in Google Cloud Console

## API Integration Details

### Model Used
- **Gemini 2.5 Flash** - Fast, cost-effective, perfect for dialogue
- Latest model with best dialogue quality
- Supports up to 1M tokens per minute

### Example Prompts

**NPC Dialogue**
```
Roleplay Context: You are a sad, lonely ghost. You speak in riddles.
Current Location: The Damp Cellar.

KEY GAME INFO:
- The player is asking you: "Where do I go?"
- The way forward (Stairs/Goal) is located to the North of the player's current position.

Instructions:
- If the player asks for directions, give them a hint based on the direction provided
- Do NOT explicitly say "Go North"
- Keep response under 30 words
```

**Dungeon Tip**
```
You are a narrator for a pixel dungeon game.
Current Level: The Damp Cellar.
Player Health: 18.

Give a one-sentence atmospheric description of the smell, sound, or feeling of this specific level.
```

## Future Enhancements

Planned features:
- Multi-turn conversation memory
- Custom personality system for NPCs
- World state awareness (killed enemies, completed quests)
- Player name integration
- Difficulty-based dialogue changes

## Support

If you encounter issues:
1. Check this guide's Troubleshooting section
2. Verify your API key is from [Google AI Studio](https://aistudio.google.com)
3. Try with a fresh browser profile
4. Check browser console (F12) for errors

---

**Version**: 1.0  
**Last Updated**: February 2026  
**Model**: Gemini 2.5 Flash
